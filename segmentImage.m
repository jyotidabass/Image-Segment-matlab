function [BW,maskedImage] = segmentImage(RGB)
%segmentImage Segment image using auto-generated code from imageSegmenter app
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the imageSegmenter app. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 14-Jun-2022
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Graph cut
foregroundInd = [2354336 2354371 2354401 2372838 2372842 2393673 2393825 2393834 2402929 2402933 2414509 2414696 2423768 2423964 2433032 2433237 2444608 2454089 2463358 2484206 2484210 2493235 2514323 2553703 2604668 2655629 2685741 2725118 2766810 2796918 2836294 2857138 2887246 2938198 2956726 3007678 3067894 3107262 3248525 3290209 3350412 3359354 3359358 3368622 3380202 3389466 3389471 3398735 3410306 3410319 3419583 3428847 3428852 3429151 3440432 3449700 3461280 3461567 3479812 3500661 3509929 3540041 3540289 3551621 3581734 3621332 3630374 3651431 3672071 3711443 3711629 3753304 3762399 3783247 3783399 3792511 3813499 3831888 3843468 3843585 3873584 3892112 3892195 3913026 3933809 3933848 3943077 3952346 3952350 3952354 3952359 ];
backgroundInd = [612726 612730 621990 633570 642834 642838 663687 672955 693803 703076 712344 712488 723929 723933 723950 733197 733201 733206 733210 733214 742478 742483 754063 763335 772604 802720 823569 862949 913910 964867 965297 1004243 1063946 1063981 1064050 1094567 1095193 1105560 1105791 1114803 1116050 1136898 1145197 1155426 1166367 1167006 1176270 1197114 1205040 1217319 1248053 1295842 1317511 1325363 1367025 1376954 1385540 1427215 1466565 1508244 1527585 1539269 1599420 1617070 1629545 1648630 1719896 1780129 1831094 1869484 1891332 1909877 1930717 1951569 1961238 1970102 1990946 1990950 2000218 2011794 2011798 2011803 2021058 2021062 2021067 2032642 2032647 2061695 2222932 2364208 2394316 2432237 2524030 2616679 2656059 2716284 2755660 2806621 2825957 2866841 2887690 2927066 2978022 3028974 3047502 3089190 3128562 3158670 3179514 3209622 3248994 3462014 3641202 3661116 3922724 3964399 4033866 4084805 4114909 4165852 4205216 4256155 4286254 4335933 4335963 4335985 4335994 4335998 4336011 4336015 4336020 4336024 4336028 4336033 4336037 4345184 4346452 4354382 4384660 4415915 4435230 4677545 4727441 4847873 4848872 5182276 5372145 5673142 5764583 5904660 5933816 6086863 6126331 6136173 6186725 6187103 6207926 6216920 6217150 6217168 6226341 6226384 ];
L = superpixels(X,35859,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = lazysnapping(scaledX,L,foregroundInd,backgroundInd);

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;
end

function out = prepLab(in)

% Convert L*a*b* image to range [0,1]
out = in;
out(:,:,1) = in(:,:,1) / 100;  % L range is [0 100].
out(:,:,2) = (in(:,:,2) + 86.1827) / 184.4170;  % a* range is [-86.1827,98.2343].
out(:,:,3) = (in(:,:,3) + 107.8602) / 202.3382;  % b* range is [-107.8602,94.4780].

end
